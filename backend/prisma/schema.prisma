// This is your Prisma schema file
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Player {
  id              Int       @id @default(autoincrement())
  nama            String
  noHp            String?   @unique @map("no_hp")
  tglBergabung    DateTime  @map("tgl_bergabung")
  posisiDefault   String    @map("posisi_default") // 'GK', 'DEF', 'MID', 'FW'
  skillPot        Int       @default(1) @map("skill_pot") // 1-5
  isActive        Boolean   @default(true) @map("is_active")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  participants    EventParticipant[]
  assignments     TeamAssignment[]

  @@index([posisiDefault])
  @@index([isActive])
  @@index([skillPot])
  @@map("players")
}

model Event {
  id              Int       @id @default(autoincrement())
  judul           String
  tglEvent        DateTime  @map("tgl_event")
  jumlahTim       Int       @map("jumlah_tim")
  formasi         String    // e.g., "3-5-2", "4-4-2"

  // Derived from formation
  jumlahGk        Int       @default(1) @map("jumlah_gk")
  jumlahDef       Int       @map("jumlah_def")
  jumlahMid       Int       @map("jumlah_mid")
  jumlahFw        Int       @map("jumlah_fw")

  status          String    @default("draft") // 'draft', 'completed'
  notes           String?
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  participants    EventParticipant[]
  assignments     TeamAssignment[]

  @@index([tglEvent])
  @@index([status])
  @@map("events")
}

model EventParticipant {
  id                  Int       @id @default(autoincrement())
  eventId             Int       @map("event_id")
  playerId            Int       @map("player_id")
  posisiUntukEvent    String    @map("posisi_untuk_event") // Position for THIS event
  createdAt           DateTime  @default(now()) @map("created_at")

  event               Event     @relation(fields: [eventId], references: [id], onDelete: Cascade)
  player              Player    @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([eventId, playerId])
  @@index([eventId])
  @@index([playerId])
  @@map("event_participants")
}

model TeamAssignment {
  id              Int       @id @default(autoincrement())
  eventId         Int       @map("event_id")
  playerId        Int       @map("player_id")
  teamNumber      Int       @map("team_number") // 1, 2, 3, etc.
  teamColor       String    @map("team_color")
  posisi          String    // Position they played
  createdAt       DateTime  @default(now()) @map("created_at")

  event           Event     @relation(fields: [eventId], references: [id], onDelete: Cascade)
  player          Player    @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([eventId])
  @@index([playerId])
  @@index([eventId, teamNumber])
  @@map("team_assignments")
}

model TeamColor {
  id              Int       @id @default(autoincrement())
  colorName       String    @unique @map("color_name")
  hexCode         String    @map("hex_code")
  isActive        Boolean   @default(true) @map("is_active")
  displayOrder    Int       @default(0) @map("display_order")

  @@map("team_colors")
}

model User {
  id              Int       @id @default(autoincrement())
  username        String    @unique
  passwordHash    String    @map("password_hash")
  role            String    @default("user") // 'admin', 'user'
  isActive        Boolean   @default(true) @map("is_active")
  createdAt       DateTime  @default(now()) @map("created_at")
  lastLogin       DateTime? @map("last_login")

  @@index([username])
  @@map("users")
}
